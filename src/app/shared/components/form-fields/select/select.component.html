<div class="neo-select">
  @if (label !== "" && label !== undefined && label !== null) {
    <label
      (click)="toggleDropdown($event)"
      [for]="id"
      [id]="labelId()"
      class="neo-select__label"
      [class.neo-select__label--required]="required"
    >
      <span [innerHtml]="label"></span>
    </label>
  }
  <div
    #selectField
    #selectDropdown="cdkOverlayOrigin"
    class="neo-select__field size-{{ inputSize }}"
    (click)="toggleDropdown($event)"
    [title]="title || label"
    [class.neo-select__field--error]="hasErrors() || _hasErrors()"
    [class.neo-select__field--disabled]="disabled"
    [class.neo-select__field--transparent]="transparent"
    [attr.aria-labelledby]="labelId()"
    [attr.aria-label]="label"
    [attr.aria-required]="required"
    [attr.aria-expanded]="isDropdownOpened()"
    [attr.aria-haspopup]="true"
    [attr.aria-controls]="id"
    [attr.aria-disabled]="disabled"
    [attr.aria-invalid]="hasErrors() || _hasErrors()"
    [attr.aria-multiselectable]="multiple"
    [attr.aria-owns]="id"
    [attr.aria-describedby]="title || label"
    [attr.id]="id"
    cdkOverlayOrigin
  >
    <div class="neo-select__field__value">
      @if (!multiple && getSelectedOptions().length > 0) {
        <span
          class="neo-select__field__value__label"
          [innerHTML]="getSelectedOptions()[0].getLabelText() | safeHtml"
        ></span>
      }
      @if (multiple && getSelectedOptions().length > 0) {
        <span
          class="neo-select__field__value__label"
          [innerHTML]="
            getSelectedOptions().length === 1
              ? (getSelectedOptions()[0].getLabelText() | safeHtml)
              : getSelectedOptions().length +
                ' ' +
                ('select.multiple_choices' | translate)
          "
        ></span>
      }
      @if (getSelectedOptions().length === 0) {
        <span class="neo-select__field__value__label">{{
          placeholder || "select.select_option" | translate
        }}</span>
      }
    </div>
    <i
      class="ri-arrow-down-s-line neo-select__field__arrow-dropdown"
      [ngClass]="{ open: isDropdownOpened() }"
    ></i>
  </div>

  <ng-template
    cdkConnectedOverlay
    [cdkConnectedOverlayOrigin]="selectDropdown"
    [cdkConnectedOverlayOpen]="isDropdownOpened()"
    [cdkConnectedOverlayScrollStrategy]="scrollStrategy"
    cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
    [cdkConnectedOverlayHasBackdrop]="true"
    (attach)="attachDropdown()"
    (detach)="closeDropdown()"
    (backdropClick)="closeDropdown()"
  >
    <div
      class="neo-select__dropdown"
      [ngStyle]="{ 'min-width': selectField.offsetWidth + 'px' }"
      role="listbox"
      tabindex="-1"
      [cdkTrapFocus]="true"
      [cdkTrapFocusAutoCapture]="true"
    >
      @if (searchable && options.length > 0) {
        <div class="neo-select__dropdown__search">
          <input
            #searchInput
            class="neo-select__dropdown__search__input"
            type="text"
            [placeholder]="placeholderSearch || ('app.buscar' | translate)"
            (input)="searchOption(searchInput.value)"
          />
          <i class="ri-search-line neo-select__dropdown__search__icon"></i>
        </div>
      }
      <div
        class="neo-select__dropdown__options"
        [class.neo-select__dropdown__options--empty]="options.length === 0"
      >
        <ng-content select="neo-option, neo-option-groups"></ng-content>
      </div>
    </div>
  </ng-template>
</div>
