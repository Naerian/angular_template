<div class="calendar-picker">
  @if (viewMode() === "default") {
    <div class="calendar-picker__default">
      <div class="calendar-picker__header">
        <button
          class="calendar-picker__header__btn"
          tabindex="0"
          type="button"
          (click)="prevMonth()"
          [title]="'CALENDAR.PREV_MONTH' | translate"
        >
          <i class="ri-arrow-left-s-line"></i>
        </button>
        <div class="calendar-picker__header__actions">
          <button
            class="calendar-picker__header__actions--selector"
            tabindex="0"
            type="button"
            (click)="chageViewMode('months', $event)"
            [title]="'CALENDAR.CHANGE_MONTH' | translate"
          >
            {{
              "CALENDAR." + (currentViewDate() | date: "MMMM" | uppercase)
                | translate
            }}
            <i class="ri-arrow-down-s-line arrow-dropdown"></i>
          </button>
          <button
            class="calendar-picker__header__actions--selector"
            tabindex="0"
            type="button"
            (click)="chageViewMode('years', $event)"
            [title]="'CALENDAR.CHANGE_YEAR' | translate"
          >
            {{ currentViewDate() | date: "yyyy" }}
            <i class="ri-arrow-down-s-line arrow-dropdown"></i>
          </button>
        </div>
        <button
          tabindex="0"
          type="button"
          class="calendar-picker__header__btn"
          (click)="nextMonth()"
          [title]="'CALENDAR.NEXT_MONTH' | translate"
        >
          <i class="ri-arrow-right-s-line"></i>
        </button>
      </div>

      <div class="calendar-picker__content">
        <div class="calendar-picker__days">
          @for (dayKey of WEEK_DAYS; track dayKey) {
            <span>{{ dayKey | translate }}</span>
          }
        </div>

        <div
          class="calendar-picker__weeks"
          role="grid"
          [attr.aria-label]="getAriaLabelForCalendar()"
        >
          <!-- Loop through weeks of the month -->
          @for (week of daysInMonth(); track week[0].date.valueOf()) {
            <div class="calendar-picker__week" role="row">
              @for (day of week; track day.date.valueOf()) {
                <button
                  type="button"
                  role="gridcell"
                  tabindex="{{ !day.isCurrentMonth ? -1 : 0 }}"
                  (click)="selectItem(day, $event)"
                  class="calendar-picker__day"
                  [class.calendar-picker__day--disabled]="day.isDisabled"
                  [class.calendar-picker__day--no_current_month]="
                    !day.isCurrentMonth
                  "
                  [attr.aria-label]="day.date.toDate() | date: 'dd/MM/yyyy'"
                  [attr.aria-selected]="day.isSelected || null"
                  [attr.aria-disabled]="!day.isCurrentMonth || day.isDisabled"
                  [attr.aria-current]="day.isToday"
                  [class.calendar-picker__day--selected]="day.isSelected"
                  [class.calendar-picker__day--today]="day.isToday"
                  [title]="day.date.toDate() | date: 'dd/MM/yyyy'"
                >
                  {{ day.date.toDate() | date: "dd" }}
                </button>
              }
            </div>
          }
        </div>
      </div>
    </div>
  } @else if (viewMode() === "months") {
    <div
      class="calendar-picker__months"
      cdkTrapFocus
      [cdkTrapFocusAutoCapture]="true"
    >
      <div class="calendar-picker__header">
        <span class="calendar-picker__header__title">
          {{ "CALENDAR.MONTH" | translate }}
        </span>
      </div>
      <div class="calendar-picker__content calendar-picker__months__content">
        @for (month of allMonths; track month) {
          <button
            type="button"
            tabindex="0"
            class="calendar-picker__month"
            [class.selected]="(currentViewDate() | date: 'MMMM') === month"
            (click)="changeMonth($index, $event)"
            [title]="'CALENDAR.' + month | uppercase | translate"
          >
            {{ "CALENDAR." + month | uppercase | translate }}
          </button>
        }
      </div>
      <div class="calendar-picker__back">
        <button
          type="button"
          class="calendar-picker__back__btn"
          tabindex="0"
          (click)="chageViewMode('default', $event)"
          [title]="'APP.BACK' | translate"
        >
          <i class="ri-calendar-close-fill"></i>
        </button>
      </div>
    </div>
  } @else {
    <div
      class="calendar-picker__years"
      cdkTrapFocus
      [cdkTrapFocusAutoCapture]="true"
    >
      <div class="calendar-picker__header">
        <button
          type="button"
          tabindex="0"
          class="calendar-picker__header__btn"
          (click)="loadPastYears()"
          [title]="'APP.PREVIOUS' | translate"
        >
          <i class="ri-arrow-left-s-line"></i>
        </button>
        <span class="calendar-picker__header__title">
          {{ "CALENDAR.YEAR" | translate }}
        </span>
        <button
          type="button"
          tabindex="0"
          class="calendar-picker__header__btn"
          (click)="loadFutureYears()"
          [title]="'APP.NEXT' | translate"
        >
          <i class="ri-arrow-right-s-line"></i>
        </button>
      </div>
      <div class="calendar-picker__content calendar-picker__years__content">
        @for (year of allYears; track year) {
          <button
            tabindex="0"
            type="button"
            class="calendar-picker__year"
            [class.selected]="(currentViewDate() | date: 'yyyy') === year"
            (click)="changeYear(year, $event)"
            [title]="year"
          >
            {{ year }}
          </button>
        }
      </div>
      <div class="calendar-picker__back">
        <button
          type="button"
          class="calendar-picker__back__btn"
          tabindex="0"
          (click)="chageViewMode('default', $event)"
          [title]="'APP.BACK' | translate"
        >
          <i class="ri-calendar-close-fill"></i>
        </button>
      </div>
    </div>
  }
</div>
